<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç²µèªè©å½™ç™¼éŸ³æŒ‡å— (Google èªéŸ³ç‰ˆ)</title>
    
    <meta name="referrer" content="no-referrer">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f4f7f9; }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center p-4">

    <div id="app" class="w-full max-w-4xl bg-white shadow-2xl rounded-xl p-6 md:p-10">
        <h1 id="header-title" class="text-3xl font-bold text-gray-800 text-center mb-6">ç²µèªè©å½™ç™¼éŸ³ç³»çµ± (Google èªéŸ³ç‰ˆ)</h1>
        
        <div id="breadcrumb" class="text-sm text-gray-500 mb-6 flex space-x-2 items-center">
            <span class="cursor-pointer hover:text-blue-600 transition duration-150" onclick="renderHome()">ä¸»é </span>
            <span id="breadcrumb-book" class="hidden">/ <span class="font-medium text-gray-600 transition duration-150"></span></span>
            <span id="breadcrumb-lesson" class="hidden">/ <span class="font-medium text-gray-800 transition duration-150"></span></span>
        </div>

        <div id="browser-tts-info" class="p-3 bg-blue-100 text-blue-700 rounded-lg border border-blue-400 mt-2 mb-6">
            ğŸ“¢ ä½¿ç”¨ Google ç¶²çµ¡èªéŸ³ã€‚è«‹ç¢ºä¿å·²é€£æ¥äº’è¯ç¶²ã€‚
        </div>
        
        <div id="content"></div>
    </div>

<script type="module">
    
    // ==========================================
    // â–¼â–¼â–¼ èªé€Ÿè¨­å®šå€ â–¼â–¼â–¼
    // ==========================================
    // 1.0 = æ­£å¸¸é€Ÿåº¦
    // 0.8 = æ…¢é€Ÿ
    // 1.2 = å¿«é€Ÿ
    const speechSpeed = 0.9; 

    const learningMaterial = {
        1: { 
            title: "ç¬¬ä¸€å†Š",
            lessons: [
                { id: 1, title: "ç¬¬ä¸€èª²", words: [ 
                    { text: "æˆ‘", jyutping: "ngo5" }, { text: "ä½ ", jyutping: "nei5" }, { text: "æ˜¯", jyutping: "si6" },
                    { text: "å¥³", jyutping: "neoi5", speakText: "é¤’" }, 
                    { text: "ä½ å¥½", jyutping: "nei5 hou2" }, { text: "å†è¦‹", jyutping: "zoi3 gin3" }, { text: "è¬è¬", jyutping: "ze6 ze6" } 
                ] },
                { id: 2, title: "ç¬¬äºŒèª²", words: [ 
                    { text: "ä¸€", jyutping: "jat1" }, { text: "äºŒ", jyutping: "ji6" }, { text: "ä¸‰", jyutping: "saam1" }, 
                    { text: "å››", jyutping: "sei3" }, { text: "äº”", jyutping: "ng5" }, { text: "å…­", jyutping: "luk6" }, 
                    { text: "ä¸ƒ", jyutping: "cat1" }, { text: "å…«", jyutping: "baat3" }, { text: "ä¹", jyutping: "gau2" }, 
                    { text: "å", jyutping: "sap6" }
                ] },
                { id: 3, title: "ç¬¬ä¸‰èª² (å¤šéŸ³å­—æ¸¬è©¦)", words: [
                    { text: "è¡Œ (è¡Œèµ°)", jyutping: "haang4", speakText: "æ­" },
                    { text: "è¡Œ (éŠ€è¡Œ)", jyutping: "hong4", speakText: "æ­" }, 
                    { text: "å¿«æ¨‚", jyutping: "faai3 lok6", speakText: "å¿«æ´›" },
                    { text: "éŸ³æ¨‚", jyutping: "jam1 ngok6", speakText: "éŸ³å²³" }
                ] },
                { id: 4, title: "ç¬¬å››èª²", words: [{ text: "å±‹ä¼", jyutping: "uk1 kei2" }] }
            ]
        },

        2: {
            title: "ç¬¬äºŒå†Š",
            lessons: [
                { id: 5, title: "ç¬¬äº”èª²", words: [
                    { text: "è¦ºå¾—", jyutping: "gok3 dak1" }, 
                    { text: "èˆ’æœ", jyutping: "syu1 fuk6" }, 
                    { text: "ç™¼ç‡’", jyutping: "faat3 siu1", speakText: "ç™¼å®µ"},
                    { text: "é ­ç—›", jyutping: "tau4 tung3" }, 
                    { text: "å–‰åš¨ç—›", jyutping: "hau4 lung4 tung3" }, 
                    { text: "è‚šç€‰", jyutping: "tou5 se3" }, 
                    { text: "é†«é™¢", jyutping: "ji1 jyun2" }, 
                    { text: "è­·å£«", jyutping: "wu6 si6" }, 
                    { text: "è¨ºæ–·", jyutping: "can2 dyun6" }, 
                    { text: "æ„Ÿå†’", jyutping: "gam2 mo6" }, 
                    { text: "è—¥", jyutping: "joek6" }
                ] },
                { id: 6, title: "ç¬¬å…­èª²", words: [{ text: "ç´…è‰²", jyutping: "hung4 sik1" }] },
                { id: 7, title: "ç¬¬ä¸ƒèª²", words: [{ text: "çˆ¸çˆ¸", jyutping: "baa1 baa1" }] },
                { id: 8, title: "ç¬¬å…«èª²", words: [{ text: "ä¸€äºŒä¸‰", jyutping: "yat1 yi6 saam1" }] },
                { id: 9, title: "ç¬¬ä¹èª²", words: [{ text: "å¥½é£Ÿ", jyutping: "hou2 sik6" }] },
                { id: 10, title: "ç¬¬åèª²", words: [{ text: "é¦™æ¸¯", jyutping: "hoeng1 gong2" }] }
            ]
        },
        3: { title: "ç¬¬ä¸‰å†Š", lessons: Array.from({ length: 5 }, (_, i) => ({ id: i + 1, title: `ç¬¬${i + 1}èª²`, words: [ { text: `å•†æ¥­ç”¨èª`, jyutping: "soeng1 yip6" } ] })) },
        4: { title: "ç¬¬å››å†Š", lessons: Array.from({ length: 5 }, (_, i) => ({ id: i + 1, title: `ç¬¬${i + 1}èª²`, words: [ { text: `å£èªè¡¨é”`, jyutping: "hau2 yu5" } ] })) }
    };
    
    // --- æ ¸å¿ƒé‚è¼¯ ---
    let currentView = 'home';
    let selectedBook = null;
    let selectedLesson = null;
    const contentDiv = document.getElementById('content');
    const headerTitle = document.getElementById('header-title');
    const breadcrumbBook = document.getElementById('breadcrumb-book');
    const breadcrumbLesson = document.getElementById('breadcrumb-lesson');
    let currentAudio = null;

    function speakCantonese(text) {
        if (currentAudio) {
            currentAudio.pause();
            currentAudio.currentTime = 0;
        }
        
        const encodedText = encodeURIComponent(text);
        // Google TTS URL
        const url = `https://translate.google.com/translate_tts?ie=UTF-8&q=${encodedText}&tl=zh-yue&total=1&idx=0&textlen=${text.length}&client=tw-ob&prev=input&ttsspeed=1`;
        
        currentAudio = new Audio(url);
        
        // --- é€™è£¡å°±æ˜¯æ§åˆ¶èªé€Ÿçš„é—œéµ ---
        currentAudio.playbackRate = speechSpeed; 
        
        currentAudio.onerror = function() { alert("æ’­æ”¾å¤±æ•—ã€‚è«‹æª¢æŸ¥ç¶²çµ¡é€£æ¥ã€‚"); };
        currentAudio.play().catch(e => console.error(e));
    }

    window.handlePronunciationRequest = function(text, jyutping, speakText) {
        const textToSpeak = speakText ? speakText : text;
        console.log(`Speaking: ${textToSpeak} (Speed: ${speechSpeed})`);
        speakCantonese(textToSpeak);
    }

    // --- æ¸²æŸ“å‡½æ•¸ ---
    function renderHome() {
        currentView = 'home';
        selectedBook = null;
        selectedLesson = null;
        headerTitle.textContent = "ç²µèªè©å½™å­¸ç¿’ç³»çµ±";
        breadcrumbBook.classList.add('hidden');
        breadcrumbLesson.classList.add('hidden');
        
        let html = '<div class="grid grid-cols-2 md:grid-cols-4 gap-4">';
        Object.keys(learningMaterial).forEach(bookId => {
            html += `<button onclick="selectBook(${bookId})" class="p-6 bg-blue-500 text-white font-semibold text-lg rounded-lg shadow-md hover:bg-blue-600 transition duration-150 transform hover:scale-105">${learningMaterial[bookId].title}</button>`;
        });
        html += '</div>';
        contentDiv.innerHTML = html;
    }

    function renderBook() {
        const book = learningMaterial[selectedBook];
        headerTitle.textContent = `${book.title} - é¸æ“‡èª²å ‚`;
        breadcrumbBook.querySelector('span').textContent = book.title;
        breadcrumbBook.classList.remove('hidden');
        breadcrumbLesson.classList.add('hidden');
        
        let html = '<div class="grid grid-cols-2 md:grid-cols-5 gap-4">';
        book.lessons.forEach(lesson => {
            html += `<button onclick="selectLesson(${lesson.id})" class="p-4 bg-green-500 text-white font-semibold rounded-lg shadow-md hover:bg-green-600 transition duration-150">${lesson.title}</button>`;
        });
        html += '</div>';
        contentDiv.innerHTML = html;
    }

    function renderLesson() {
        const book = learningMaterial[selectedBook];
        const lesson = book.lessons.find(l => l.id === selectedLesson);
        headerTitle.textContent = `${book.title} - ${lesson.title}`;
        breadcrumbLesson.querySelector('span').textContent = lesson.title;
        breadcrumbLesson.classList.remove('hidden');
        
        let html = `
            <div class="mb-6 flex justify-start">
                <button onclick="renderBook()" class="flex items-center space-x-2 px-4 py-2 bg-yellow-500 text-white font-semibold rounded-lg shadow-md hover:bg-yellow-600 transition duration-150">
                    <span>â¬… è¿”å›èª²å ‚åˆ—è¡¨</span>
                </button>
            </div>
            <div class="space-y-4">
        `;
        lesson.words.forEach((item) => {
            html += `
                <div class="p-4 bg-gray-100 rounded-lg shadow-inner cursor-pointer hover:bg-yellow-100 transition duration-150 border-l-4 border-red-500"
                    onclick="handlePronunciationRequest('${item.text}', '${item.jyutping}', '${item.speakText || ''}')">
                    <div class="flex justify-between items-center">
                        <div class="text-3xl font-bold text-gray-800">${item.text}</div>
                        <button class="bg-red-500 text-white text-sm font-medium px-3 py-1 rounded-full shadow-md hover:bg-red-600 transition duration-150">ğŸ”Š æ’­æ”¾</button>
                    </div>
                    <div class="text-sm text-gray-500 mt-1">${item.jyutping}</div>
                </div>
            `;
        });
        html += '</div>';
        contentDiv.innerHTML = html;
    }

    window.selectBook = (id) => { selectedBook = id; renderBook(); };
    window.selectLesson = (id) => { selectedLesson = id; renderLesson(); };
    window.renderHome = renderHome;
    window.renderBook = renderBook;
    window.onload = renderHome;
</script>
</body>

</html>

